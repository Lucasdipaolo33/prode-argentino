<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRODE ARGENTINO</title>
    <link rel="icon" href="https://img.icons8.com/emoji/48/soccer-ball-emoji.png" type="image/png">
    <link rel="apple-touch-icon" href="https://img.icons8.com/emoji/48/soccer-ball-emoji.png">

    <style>
        :root {
            --fondo: #050505;
            --tarjeta: #111418;
            --tarjeta-clara: #1a1e24;
            --acento: #00ff88;
            --azul-metal: #3b82f6;
            --amarillo: #fbbf24;
            --rojo: #ff3333;
            --texto: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body {
            background-color: #000;
            color: var(--texto);
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 0;
            height: 100vh; width: 100vw;
            overflow: hidden;
            display: flex; justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            height: 100%;
            background-color: var(--fondo);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* HEADER */
        .header {
            width: 100%; height: 115px;
            padding: 8px 10px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #1e293b;
            background: linear-gradient(180deg, #0f172a 0%, #000 100%);
            flex-shrink: 0;
        }

        .col-izq { display: flex; flex-direction: column; gap: 1px; min-width: 90px; }
        .txt-fecha { color: #fff; font-weight: 800; font-size: 0.6rem; opacity: 0.7; }
        .num-fecha { color: #fff; font-weight: 900; font-size: 0.8rem; letter-spacing: 1px; }
        .cierre-box { margin-top: 4px; display: flex; flex-direction: column; background: rgba(255, 51, 51, 0.1); padding: 3px 6px; border-radius: 6px; border-left: 2px solid var(--rojo); }
        .cierre-label { color: var(--rojo); font-size: 0.5rem; font-weight: 900; }
        #countdown { color: var(--rojo); font-size: 0.75rem; font-weight: 900; }

        /* TARJETAS DE PUNTOS AGRANDADAS */
        .col-centro { display: flex; gap: 6px; }
        .puntaje-card { 
            background: rgba(30, 41, 59, 0.8); 
            border: 1.5px solid var(--azul-metal); 
            padding: 6px 4px; 
            border-radius: 10px; 
            text-align: center; 
            min-width: 75px; /* Más anchas */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }
        .puntaje-label { 
            display: block; 
            font-size: 0.5rem; /* Letra de etiqueta más clara */
            color: var(--amarillo); 
            font-weight: 900; 
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        .puntaje-valor { 
            font-size: 1.2rem; /* Número bien grande */
            font-weight: 900; 
            color: #ffffff; 
            line-height: 1;
        }

        .col-der { display: flex; flex-direction: column; gap: 4px; min-width: 100px; }
        .saldo-wrapper { display: flex; align-items: center; justify-content: center; gap: 4px; background: #000; border: 1px solid var(--azul-metal); padding: 3px; border-radius: 6px; }
        .saldo-label { font-size: 0.6rem; font-weight: 900; color: #fff; }
        .saldo-monto { color: var(--acento); font-weight: 900; font-size: 0.8rem; }
        .usuario-card { background: #1e293b; border-radius: 4px; padding: 3px; text-align: center; }
        .usuario-nombre { color: #fff; font-size: 0.55rem; font-weight: 800; }

        /* LISTADO */
        .partidos-list { 
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column; 
            justify-content: space-evenly;
            padding: 4px 0;
            overflow: hidden; 
        }

        .fila { 
            width: 96%;
            margin: 0 auto;
            height: calc((100vh - 190px) / 15); 
            min-height: 30px;
            max-height: 42px;
            display: flex; align-items: center; justify-content: space-between; 
            padding: 0 10px; border-radius: 50px; 
            border: 1px solid rgba(59, 130, 246, 0.12); 
            flex-shrink: 0;
        }
        .fila:nth-child(odd) { background: var(--tarjeta); }
        .fila:nth-child(even) { background: var(--tarjeta-clara); }

        .equipo { width: 38%; font-size: 0.6rem; font-weight: 800; text-transform: uppercase; text-align: center; }
        .controles { display: flex; gap: 5px; width: 24%; justify-content: center; }

        .btn-lev { width: 26px; height: 26px; background: #000; border: 1px solid #333; border-radius: 50%; color: #666; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.55rem; cursor: pointer; transition: 0.2s; }
        .btn-lev.active { border-color: var(--acento); color: var(--acento); box-shadow: 0 0 8px rgba(0, 255, 136, 0.2); background: #0a1a10; }
        .btn-lev.active::after { content: '⚽'; font-size: 0.65rem; }
        .btn-lev.active span { display: none; }

        /* FOOTER */
        .footer { 
            width: 100%; height: 70px; 
            display: flex; justify-content: center; align-items: center; 
            background: #000; flex-shrink: 0;
            border-top: 1px solid #1e293b;
        }
        .btn-confirmar { width: 90%; height: 44px; background: linear-gradient(135deg, #1e40af, #3b82f6); border: none; border-radius: 50px; color: white; font-weight: 900; text-transform: uppercase; font-size: 0.85rem; cursor: pointer; letter-spacing: 1px; }

        /* MODALES */
        #overlay-confirm, #overlay-error {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(4px);
            display: none; justify-content: center; align-items: center; z-index: 9999;
        }
        .modal { background: #111827; width: 80%; padding: 20px; border-radius: 20px; border: 2px solid var(--azul-metal); text-align: center; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">
            <div class="col-izq">
                <span class="txt-fecha" id="fecha">--/--/----</span>
                <span class="num-fecha">FECHA 1</span>
                <div class="cierre-box">
                    <span class="cierre-label">CIERRE</span>
                    <span id="countdown">0d 00:00:00</span>
                </div>
            </div>
            <div class="col-centro">
                <div class="puntaje-card">
                    <span class="puntaje-label">FECHA</span>
                    <span class="puntaje-valor">12</span>
                </div>
                <div class="puntaje-card">
                    <span class="puntaje-label">GLOBAL</span>
                    <span class="puntaje-valor">145</span>
                </div>
            </div>
            <div class="col-der">
                <div class="saldo-wrapper">
                    <span class="saldo-label">SALDO</span>
                    <span class="saldo-monto">$5.400</span>
                </div>
                <div class="usuario-card">
                    <span class="usuario-nombre">LUCAS DI PAOLO</span>
                </div>
            </div>
        </div>

        <div class="partidos-list">
            {% for p in partidos %}
            <div class="fila">
                <div class="equipo">{{ p.local }}</div>
                <div class="controles">
                    <div class="btn-lev" onclick="votar(this)"><span>L</span></div>
                    <div class="btn-lev" onclick="votar(this)"><span>E</span></div>
                    <div class="btn-lev" onclick="votar(this)"><span>V</span></div>
                </div>
                <div class="equipo">{{ p.visitante }}</div>
            </div>
            {% endfor %}
        </div>

        <div class="footer">
            <button class="btn-confirmar" onclick="validarFormulario()">Guardar Jugada</button>
        </div>

        <div id="overlay-confirm">
            <div class="modal">
                <div class="modal-titulo" style="color:var(--amarillo); font-weight:900;">⚠️ ENVIAR JUGADA</div>
                <p class="modal-txt" style="color:#fff; font-size:0.8rem; margin:15px 0;">¿Confirmás tu jugada de hoy?</p>
                <div style="display:flex; gap:10px;">
                    <button class="btn-modal" style="flex:1; padding:10px; border-radius:8px; background:#374151; color:#fff; border:none; font-weight:900;" onclick="cerrarModales()">NO</button>
                    <button class="btn-modal" style="flex:1; padding:10px; border-radius:8px; background:var(--acento); color:#000; border:none; font-weight:900;" onclick="procesarJugada()">SÍ</button>
                </div>
            </div>
        </div>

        <div id="overlay-error">
            <div class="modal">
                <div class="modal-titulo" style="color:var(--rojo); font-weight:900;">❌ INCOMPLETO</div>
                <p class="modal-txt" id="error-msg" style="color:#fff; font-size:0.8rem; margin:15px 0;"></p>
                <button class="btn-modal" style="width:100%; padding:10px; border-radius:8px; background:var(--rojo); color:#fff; border:none; font-weight:900;" onclick="cerrarModales()">CORREGIR</button>
            </div>
        </div>
    </div>

    <script>
        function actualizarTiempo() {
            document.getElementById('fecha').innerText = new Date().toLocaleDateString('es-AR');
        }
        actualizarTiempo();

        const fechaCierre = new Date().getTime() + (2 * 24 * 60 * 60 * 1000); 
        setInterval(function() {
            const ahora = new Date().getTime();
            const distancia = fechaCierre - ahora;
            const dias = Math.floor(distancia / (1000 * 60 * 60 * 24));
            const horas = Math.floor((distancia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutos = Math.floor((distancia % (1000 * 60 * 60)) / (1000 * 60));
            const segundos = Math.floor((distancia % (1000 * 60)) / 1000);
            document.getElementById("countdown").innerHTML = dias + "d " + (horas < 10 ? "0" : "") + horas + ":" + (minutos < 10 ? "0" : "") + minutos + ":" + (segundos < 10 ? "0" : "") + segundos;
        }, 1000);

        function votar(el) {
            const fila = el.closest('.fila');
            fila.querySelectorAll('.btn-lev').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            fila.style.borderColor = "rgba(0, 255, 136, 0.4)";
        }

        function limpiarCarton() {
            const filas = document.querySelectorAll('.fila');
            filas.forEach(f => {
                f.querySelectorAll('.btn-lev').forEach(b => b.classList.remove('active'));
                f.style.borderColor = "rgba(59, 130, 246, 0.12)";
            });
        }

        function validarFormulario() {
            const filas = document.querySelectorAll('.fila');
            let faltantes = 0;
            filas.forEach(f => {
                if (!f.querySelector('.btn-lev.active')) {
                    f.style.borderColor = "var(--rojo)";
                    faltantes++;
                }
            });
            if (faltantes > 0) {
                document.getElementById('error-msg').innerText = "Te faltan " + faltantes + " partidos.";
                document.getElementById('overlay-error').style.display = 'flex';
            } else {
                document.getElementById('overlay-confirm').style.display = 'flex';
            }
        }

        function cerrarModales() {
            document.getElementById('overlay-confirm').style.display = 'none';
            document.getElementById('overlay-error').style.display = 'none';
        }

        async function procesarJugada() {
            const filas = document.querySelectorAll('.fila');
            const jugada = {};
            filas.forEach((f, index) => {
                const btn = f.querySelector('.btn-lev.active span');
                if(btn) jugada[index + 1] = btn.innerText;
            });
            try {
                const response = await fetch('/guardar_jugada', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ usuario: "LUCAS DI PAOLO", predicciones: jugada })
                });
                if (response.ok) {
                    cerrarModales();
                    alert("¡Jugada enviada!");
                    limpiarCarton();
                }
            } catch (error) {
                alert("Error al enviar.");
            }
        }
    </script>
</body>
</html>
